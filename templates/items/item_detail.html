{% extends "layouts/default.html" %}
{% load static %}
{% load humanize %}
 
{% block title %}{{ title }}{% endblock %}
 
{% block content %}
        <div class="container contents">
            <div class="row">
                <div class="col-5 offset-1 mb-5">
                    {% with item.item_images.all.0 as first_image %}
                       <img class="rounded img-fluid auto" src="{{ first_image.image.url }}">
                    {% endwith %}
            	</div>
                <div class="col-6 mb-5">
                    <div class="row">
                        <div class="d-flex flex-row bd-highlight mb-5">
                             {% for image in item.item_images.all %}
                			     {%if forloop.first %}
                                 {% else %}
                            		 <div id="gallery">
                            			 <img class="justify-content-start rounded" src="{{ image.image.url }}">
                            		</div>
                            	{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                         <div class="col-12">
                            {% if user.is_authenticated %}
                                <form id="FavoriteForm" method="post" action="{% url 'items:favorite_add' item.pk %}">
                                    {% csrf_token %}
                                    <div class="d-flex justify-content-end item_upper_icons">
            				            <a onclick="submitFavoriteForm('{{ item.id }}')">
            				                <img src="{% static 'images/icon/favorite_icon.png' %}" alt="お気に入り">
            				            </a>
            				         </div>
                                </form>       
                                <script>
                                    function submitFavoriteForm(itemId) {
                                        document.getElementById('favoriteForm').submit();
                                    }
                                </script>        				                
        					{% else %}
        					    <div class="d-flex justify-content-end item_upper_icons">
        				            <a onclick="showLoginModal();">
        				                <img src="{% static 'images/icon/favorite_icon.png' %}" alt="お気に入り">
        				            </a>
        				        </div>
    				        {% endif %}

                            <h2 class="font-weight-bold">{{ item.name }}</h2>
                            <p>{{ item.description }}</p>
                            <div class="text-right">税込価格：{{ item.price | intcomma }}円</div>
                            <div class="text-right mb-3"><small>(内税{{ item.tax_percent }}%：{{ tax | intcomma }}円)</small></div>
                            <div class="row">
                                <div class="col-12 d-flex flex-row justify-content-end">
                                    <p class="text-right mr-2">個数</p>
                                        
                                    <form method="post" action="{% url 'items:add_item' item.pk %}">
                                        {% csrf_token %}
                                        <div class="col-sm d-flex flex-row justify-content-end px-0">
                                            <div class="spinner-container">
                                                <span class="spinner-sub disabled">-</span>
                                                <input class="spinner" type="number" min="1" max="50" value="1" name="amount">
                                                <span class="spinner-add">+</span>
                                            </div>
                                            <button type="submit" class="btn btn-secondary ml-2" name="button">
                                            カートに入れる
                                            </button> 
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-5 offset-1 mt-5 mb-5">
                    <h2>産地情報等</h2>
                    <p>{{item.area.description}}</p>
                </div>
                <div class="col-6 mt-5 mb-5">
                    <img class="rounded img-fluid auto" src="{{ item.area.area_image.url }}">
                </div>
            </div>
            
            <div class="row">
                <div class="col-5 offset-1 mt-5 item_detail_review_container">
                    <h2>レビュー</h2>
                    <div class="ml-5">
                        {% if average_rate%}
                            <p>平均: {{ average_rate }}</p>

                        {% endif %}
                    </div>
                </div>
                <div class="col-6 mt-5">
                    {% if reviews %}
                    <ul>
                        {% for review in reviews %}
                            <li class="item_detail_review">
                                <strong>{{ review.user.username }}</strong> さん
                                <p>評価:
                                    {% if review.rate == 5 %}
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                    {% elif review.rate == 4 %}
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="far fa-star"></span>
                                    {% elif review.rate == 3 %}
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="far fa-star"></span>
                                        <span class="far fa-star"></span>
                                    {% elif review.rate == 2 %}
                                        <span class="fas fa-star"></span>
                                        <span class="fas fa-star"></span>
                                        <span class="far fa-star"></span>
                                        <span class="far fa-star"></span>
                                        <span class="far fa-star"></span>
                                    {% elif review.rate == 1 %}
                                        <span class="fas fa-star"></span>
                                        <span class="far fa-star"></span>
                                        <span class="far fa-star"></span>
                                        <span class="far fa-star"></span>
                                        <span class="far fa-star"></span>
                                    {% endif %}
                                </p>
                                <p>コメント: {{ review.comment }}</p>
                            </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                        <div class="text-center">
                            <p>まだレビューはありません。</p>
                        </div>    
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="return_link d-flex justify-content-center">
            <button class="btn" onclick="window.history.back();return false;">＜ 戻る</button>
        </div>
        {% load static %}
        <script src="{% static 'js/spinner_script.js' %}"></script>
{% endblock %}
