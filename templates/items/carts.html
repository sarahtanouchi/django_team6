{% extends "layouts/default.html" %}
{% load humanize %}
 
{% block title %}{{ title }}{% endblock %}
 
{% block content %}
	<div class="container">
		<h1 class="h4">{{ title }}</h1>
		<div class="row">
			<div class="col-12 mt-4">
			  {% for cart in carts %}
				  <div class="card item">
					<div class="row item_row">
						<div class="col-3 item_figure">
							{% with cart.item.item_images.all.0 as first_image %}
                       			<img class="rounded img-fluid auto" src="{{ first_image.image.url }}">
                    		{% endwith %}
                            <form method="POST" action="{% url 'items:delete_cart' cart.pk %}">
	    						{% csrf_token %}
	    						<button type="submit">
		    						 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
									 	<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
									 </svg>
									 <span>削除</span>
	    						</button>
	    						 <!--<input type="submit" value="削除" >-->
                			</form>
						</div>
						<div class="col-5 item_description">
							<dl>
                                <dt>{{ cart.item.name }}</dt>
                                <dd>{{ cart.item.description }}</dd>
                             </dl>
                        </div>
                        <div class="col-4 item_description">
                    		<dl>
                                <!--<dt>価格(税込)</dt>-->
                                <!--<dd>{{ cart.item.price }}円</dd>-->
                                <dt>購入数</dt>
                                <dd>
                   					<form method="post" action="{% url 'items:update_amount' cart.item.pk %}">
                                    {% csrf_token %}
	                                    <div class="col-sm d-flex flex-row px-0">
	                                        <div class="spinner-container">
	                                            <span class="spinner-sub disabled">-</span>
	                                            <input class="spinner" type="number" min="1" max="50" value="{{ cart.amount }}" name="amount">
	                                            <span class="spinner-add">+</span>
	                                        </div>
	                                        <button type="submit" class="btn btn-secondary ml-2" name="button">
	                                        更新
	                                        </button> 
                                   		 </div>
                                	</form>
					            </dd>
                                <dt>税込価格</dt>
                                <dd>{{ cart.item.price | intcomma }}円
                                	<small>(内税{{ cart.item.tax_percent }}%)</small>
                                </dd>
                            </dl>
						</div>
					</div>
				</div>
				
				{% empty %}
                  <p class="text-center mt-5 mb-3">カート内に商品はありません</p>
				{% endfor %}
			</div>
			 
				<div class="col-12 text-center">
					{% if carts %}
						<big>
							<p class="text-right font-weight-bold mt-5">小計(税込)： {{ total | intcomma }}円</p>
						</big>
						<form class="text-center" method="post" action="{% url 'accounts:orders' %}">
		                    {% csrf_token %}
		                    <button type="submit" class="btn_lg btn_gray mb-1">ご購入手続きへ</button>
		                </form>
					{% endif %}
					<a class="text-center" href="{% url 'items:index' %}">
		            	<button class="btn_lg btn_white mt-1">商品を探す</button>
		        	</a>
		        	<div class="return_link d-flex justify-content-center">
           				 <button class="btn" onclick="window.history.back();return false;">＜ 戻る</button>
        			</div>
				</div>
		</div>
	</div>
	 {% load static %}
        <script src="{% static 'js/spinner_script.js' %}"></script>
{% endblock %}